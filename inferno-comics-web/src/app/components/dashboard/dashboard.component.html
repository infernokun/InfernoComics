<div class="dashboard-container">

  <!-- Enhanced Stats Grid -->
  @if (!loading) {
    <div class="stats-container">
      <div class="stats-grid">
        <div class="stat-card total-series" [@slideInUp]>
          <div class="stat-icon">
            <mat-icon>library_books</mat-icon>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ totalSeries | number }}</div>
            <div class="stat-label">Total Series</div>
          </div>
        </div>
        <div class="stat-card total-issues" [@slideInUp]>
          <div class="stat-icon">
            <mat-icon>auto_stories</mat-icon>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ totalIssues | number }}</div>
            <div class="stat-label">Total Issues</div>
          </div>
        </div>
        <div class="stat-card publishers" [@slideInUp]>
          <div class="stat-icon">
            <mat-icon>business</mat-icon>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ uniquePublishers }}</div>
            <div class="stat-label">Publishers</div>
            <div class="stat-detail">{{ favoritePublisher || 'Various' }}</div>
          </div>
        </div>
        <div class="stat-card complete-series" [@slideInUp]>
          <div class="stat-icon">
            <mat-icon>check_circle</mat-icon>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ completedSeriesCount | number }}</div>
            <div class="stat-label">Completed Series</div>
            <div class="stat-detail">{{ completionPercentage }}% Complete</div>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Content Sections -->
  @if (!loading) {
    <div class="content-sections">
      <!-- Publisher Breakdown -->
      <section class="publisher-section" [@fadeInUp]>
        <div class="section-header">
          <h2>
            <mat-icon>business</mat-icon>
            Publisher Breakdown
          </h2>
          @if (uniquePublishers > 4) {
          <button mat-button color="primary" (click)="showAllPublishers = !showAllPublishers">
            {{ showAllPublishers ? 'Show Less' : 'Show All' }}
          </button>
          }
        </div>
        <div class="publisher-grid">
          @for (pub of (showAllPublishers ? publisherStats : publisherStats.slice(0, 6)); track pub) {
            <div
              class="publisher-card"
              [@scaleIn]>
              <div class="publisher-logo">
                <div class="publisher-fallback">{{ pub.name.charAt(0) }}</div>
              </div>
              <div class="publisher-info">
                <h3>{{ pub.name }}</h3>
                <p>{{ pub.count }} series</p>
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="(pub.count / totalSeries) * 100"></div>
                </div>
              </div>
            </div>
          }
        </div>
      </section>
      <!-- All Series -->
      <section class="series-section" [@fadeInUp]>
        <app-series-list></app-series-list>
      </section>
    </div>
  }

  <!-- Loading State -->
  @if (loading) {
    <div class="stats-container">
      <div class="stats-grid">
        @for (i of [1, 2, 3, 4]; track i) {
          <div class="stat-card skeleton-card">
            <ngx-skeleton-loader
              [theme]="{ width: '40px', height: '40px', borderRadius: '50%', marginBottom: '16px' }">
            </ngx-skeleton-loader>
            <ngx-skeleton-loader
              [theme]="{ width: '60px', height: '32px', marginBottom: '8px' }">
            </ngx-skeleton-loader>
            <ngx-skeleton-loader
              [theme]="{ width: '80px', height: '14px' }">
            </ngx-skeleton-loader>
          </div>
        }
      </div>
    </div>

    <div class="content-sections">
      <section class="publisher-section skeleton-section">
        <div class="section-header">
          <ngx-skeleton-loader
            [theme]="{ width: '200px', height: '28px' }">
          </ngx-skeleton-loader>
        </div>
        <div class="publisher-grid">
          @for (i of [1, 2, 3, 4, 5, 6]; track i) {
            <div class="publisher-card skeleton-card">
              <ngx-skeleton-loader
                [theme]="{ width: '44px', height: '44px', borderRadius: '10px' }">
              </ngx-skeleton-loader>
              <div class="publisher-info">
                <ngx-skeleton-loader
                  [theme]="{ width: '120px', height: '16px', marginBottom: '4px' }">
                </ngx-skeleton-loader>
                <ngx-skeleton-loader
                  [theme]="{ width: '60px', height: '12px', marginBottom: '8px' }">
                </ngx-skeleton-loader>
                <ngx-skeleton-loader
                  [theme]="{ width: '100%', height: '4px', borderRadius: '2px' }">
                </ngx-skeleton-loader>
              </div>
            </div>
          }
        </div>
      </section>

      <section class="series-section skeleton-section">
        <div class="section-header">
          <ngx-skeleton-loader
            [theme]="{ width: '150px', height: '28px' }">
          </ngx-skeleton-loader>
        </div>
        <div class="series-skeleton-grid">
          @for (i of [1, 2, 3, 4, 5, 6]; track i) {
            <div class="series-card-skeleton">
              <ngx-skeleton-loader
                [theme]="{ width: '100%', height: '200px', borderRadius: '10px 10px 0 0' }">
              </ngx-skeleton-loader>
              <div class="series-card-content">
                <ngx-skeleton-loader
                  [theme]="{ width: '80%', height: '16px', marginBottom: '8px' }">
                </ngx-skeleton-loader>
                <ngx-skeleton-loader
                  [theme]="{ width: '60%', height: '12px', marginBottom: '12px' }">
                </ngx-skeleton-loader>
                <ngx-skeleton-loader
                  [theme]="{ width: '100%', height: '4px', borderRadius: '2px' }">
                </ngx-skeleton-loader>
              </div>
            </div>
          }
        </div>
      </section>
    </div>
  }
</div>
<div class="grid-container">
    <div class="grid-header">
        <h2 class="grid-title">Progress Data</h2>
        <button class="refresh-button" (click)="refreshData()">
            <span class="refresh-icon">üîÑ</span>
            <span class="refresh-text">Refresh</span>
        </button>
    </div>

    <!-- Mobile Card View -->
    @if (isMobile) {
    <div class="mobile-cards">
        @for (item of progressData(); track item.sessionId) {
        <div class="progress-card" [class.state-completed]="item.state === 'COMPLETED'"
            [class.state-processing]="item.state === 'PROCESSING'" [class.state-error]="item.state === 'ERROR'"
            [class.state-pending]="item.state === 'PENDING' || item.state === 'QUEUED'">

            <div class="card-header">
                <div class="state-badge" [class]="'state-' + item.state?.toLowerCase()">
                    {{ item.state }}
                </div>
                <div class="card-actions">
                    @if (item.state === 'COMPLETED') {
                    <button class="action-btn replay-btn" (click)="replaySession(item)" title="Replay">
                        ‚ñ∂Ô∏è
                    </button>
                    <button class="action-btn add-btn" (click)="getSessionJSON(item.sessionId)" title="Add Results">
                        ‚ûï
                    </button>
                    }
                    <button class="action-btn delete-btn" (click)="deleteProgressData(item.sessionId)" title="Delete">
                        üóëÔ∏è
                    </button>
                </div>
            </div>

            <div class="card-progress">
                <div class="progress-bar-mobile">
                    <div class="progress-fill-mobile" [style.width.%]="item.percentageComplete || 0"
                        [class.processing]="item.state === 'PROCESSING'">
                    </div>
                    <span class="progress-percent">{{ item.percentageComplete || 0 }}%</span>
                </div>
                <div class="progress-counts">
                    <span class="count-item">
                        <span class="count-label">Processed</span>
                        <span class="count-value">{{ item.processedItems || 0 }}</span>
                    </span>
                    <span class="count-item">
                        <span class="count-label">Success</span>
                        <span class="count-value success">{{ item.successfulItems || 0 }}</span>
                    </span>
                    <span class="count-item">
                        <span class="count-label">Failed</span>
                        <span class="count-value failed">{{ item.failedItems || 0 }}</span>
                    </span>
                </div>
            </div>

            <div class="card-details">
                <div class="detail-row">
                    <span class="detail-label">Session ID</span>
                    <span class="detail-value session-id">{{ item.sessionId }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Started</span>
                    <span class="detail-value">{{ formatTime(item.timeStarted) }}</span>
                </div>
                @if (item.timeFinished) {
                <div class="detail-row">
                    <span class="detail-label">Finished</span>
                    <span class="detail-value">{{ formatTime(item.timeFinished) }}</span>
                </div>
                }
                @if (item.statusMessage) {
                <div class="detail-row">
                    <span class="detail-label">Status</span>
                    <span class="detail-value status-msg">{{ item.statusMessage }}</span>
                </div>
                }
            </div>

            <div class="card-footer">
                <a class="eval-link" (click)="openEvaluationUrl(item.sessionId)" *ngIf="item.state === 'COMPLETED'"
                    style="cursor: pointer; color: blue; text-decoration: underline;">
                    View Evaluation ‚Üí
                </a>
            </div>
        </div>
        }

        @if (progressData().length === 0) {
        <div class="empty-state">
            <p>No progress data available</p>
        </div>
        }
    </div>
    }

    <!-- Desktop AG-Grid View -->
    @if (!isMobile) {
    <div class="grid-wrapper ag-theme-quartz">
        <ag-grid-angular style="width: 100%; height: 100%;" class="grid-content" [gridOptions]="gridOptions"
            [rowData]="progressData()" [defaultColDef]="defaultColDef">
        </ag-grid-angular>
    </div>
    }
</div>
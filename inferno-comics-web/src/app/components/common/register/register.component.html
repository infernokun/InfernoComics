<!-- register.component.html -->
<div class="register-container">
  <div class="register-header">
    <h2>Create Account</h2>
    <p>Join us today and get started</p>
  </div>

  <form [formGroup]="registerForm" (ngSubmit)="registerClick()">
    <div class="form-section personal-info">
      <div class="form-group">
        <label for="username">Username</label>
        <div class="input-wrapper">
          <i class="material-icons icon-prefix">person</i>
          <input
            type="text"
            class="form-control"
            id="username"
            formControlName="username"
            placeholder="Create a username"
            [class.is-invalid]="usernameControl?.invalid && (usernameControl?.touched || formSubmitted)"
            autocomplete="username">
          </div>
          @if (usernameControl?.invalid && (usernameControl?.touched || formSubmitted)) {
            <div class="error-message">
              @if (usernameControl?.errors?.['required']) {
                <small>Username is required</small>
              }
              @if (usernameControl?.errors?.['minlength']) {
                <small>Username must be at least 3 characters</small>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <div class="input-wrapper">
            <i class="material-icons icon-prefix">email</i>
            <input
              type="email"
              class="form-control"
              id="email"
              formControlName="email"
              placeholder="DISABLED"
              [class.is-invalid]="emailControl?.invalid && (emailControl?.touched || formSubmitted)"
              autocomplete="email"
              [disabled]="true">
            </div>
            @if (emailControl?.invalid && (emailControl?.touched || formSubmitted)) {
              <div class="error-message">
                @if (emailControl?.errors?.['required']) {
                  <small>Email is required</small>
                }
                @if (emailControl?.errors?.['email']) {
                  <small>Please enter a valid email address</small>
                }
              </div>
            }
          </div>
        </div>

        <div class="form-section password-section">
          <div class="form-group">
            <label for="password">Password</label>
            <div class="input-wrapper">
              <i class="material-icons icon-prefix">lock</i>
              <input
                [type]="hidePassword ? 'password' : 'text'"
                class="form-control"
                id="password"
                formControlName="password"
                placeholder="Create a strong password"
                [class.is-invalid]="passwordControl?.invalid && (passwordControl?.touched || formSubmitted)"
                autocomplete="new-password">
                <i
                  class="material-icons icon-suffix clickable"
                  (click)="hidePassword = !hidePassword">
                  {{hidePassword ? 'visibility_off' : 'visibility'}}
                </i>
              </div>
              @if (passwordControl?.invalid && (passwordControl?.touched || formSubmitted)) {
                <div class="error-message">
                  @if (passwordControl?.errors?.['required']) {
                    <small>Password is required</small>
                  }
                  @if (passwordControl?.errors?.['minlength']) {
                    <small>Password must be at least 8 characters</small>
                  }
                  @if (passwordControl?.errors?.['passwordStrength']) {
                    <small>
                      Password must include uppercase, lowercase, number, and special character
                    </small>
                  }
                </div>
              }

              @if (passwordControl?.value) {
                <div class="password-strength">
                  <div class="strength-text" [style.color]="getPasswordStrength().color">
                    Password strength: {{ getPasswordStrength().text }}
                  </div>
                  <div class="strength-meter">
                    <div class="strength-meter-fill" [style.width.%]="passwordControl?.value?.length * 5"
                    [style.background-color]="getPasswordStrength().color"></div>
                  </div>
                </div>
              }
            </div>

            <div class="form-group">
              <label for="confirmPassword">Confirm Password</label>
              <div class="input-wrapper">
                <i class="material-icons icon-prefix">lock_outline</i>
                <input
                  [type]="hideConfirmPassword ? 'password' : 'text'"
                  class="form-control"
                  id="confirmPassword"
                  formControlName="confirmPassword"
                  placeholder="Confirm your password"
            [class.is-invalid]="(confirmPasswordControl?.invalid || registerForm.hasError('passwordMismatch')) && 
                                (confirmPasswordControl?.touched || formSubmitted)"
                  autocomplete="new-password">
                  <i
                    class="material-icons icon-suffix clickable"
                    (click)="hideConfirmPassword = !hideConfirmPassword">
                    {{hideConfirmPassword ? 'visibility_off' : 'visibility'}}
                  </i>
                </div>
                @if ((confirmPasswordControl?.invalid || registerForm.hasError('passwordMismatch')) &&
                  (confirmPasswordControl?.touched || formSubmitted)) {
                  <div class="error-message">
                    @if (confirmPasswordControl?.errors?.['required']) {
                      <small>Please confirm your password</small>
                    }
                    @if (registerForm.hasError('passwordMismatch')) {
                      <small>Passwords do not match</small>
                    }
                  </div>
                }
              </div>
            </div>

            @if (errorMessage) {
              <div class="alert alert-danger" role="alert">
                {{errorMessage}}
              </div>
            }

            <div class="form-section terms-section">
              <div class="terms-agreement">
                <input type="checkbox" id="terms" required>
                <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
              </div>
            </div>

            <button type="submit" class="btn btn-primary" [disabled]="busy">
              @if (!busy) {
                <span>Create Account</span>
              }
              @if (busy) {
                <div class="spinner">
                  <mat-spinner diameter="20"></mat-spinner>
                </div>
              }
            </button>
          </form>
        </div>